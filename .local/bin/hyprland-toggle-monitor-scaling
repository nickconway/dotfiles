#!/usr/bin/env bash
set -euo pipefail
set -x

config_file="$HOME/.config/hypr/monitors.conf"

monitor_config=$(sed -n '1p' "$config_file" | cut -d ' ' -f 3-  )
primay_monitor=$(echo "$monitor_config" | awk '{print $1}' | tr -d ",")
config_scale=$(echo "$monitor_config" | awk '{print $4}' | tr -d ",")

old_scale="$(hyprctl monitors -j | jq -r ".[] | select(.name == \"$primay_monitor\") | .scale")"

if [[ -z "${1:-}" ]] && [[ "$old_scale" == "1.00" ]]; then
    new_scale=$config_scale
elif [[ "${1:-}" == "config" ]]; then
    new_scale=$config_scale
elif [[ "${1:-}" == "1" ]]; then
    new_scale=1.00
else
    new_scale=1.00
fi

if [[ "$new_scale" != "$old_scale" ]]; then
    new_config="$(echo "$monitor_config" | sed "s/\S\+,/$new_scale,/4")"
    hyprctl keyword monitor "$new_config"
fi
