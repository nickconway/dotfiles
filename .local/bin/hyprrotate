#!/usr/bin/env bash

function rotate() {
    if [[ "$1" == normal* ]]; then
        TRANSFORM=0
    elif [[ "$1" == left-up* ]]; then
        TRANSFORM=1
    elif [[ "$1" == bottom-up* ]]; then
        TRANSFORM=2
    elif [[ "$1" == right-up* ]]; then
        TRANSFORM=3
    fi

    while read -r MONITOR; do
        hyprctl --batch "keyword monitor $MONITOR, transform, $TRANSFORM"
    done < <(hyprctl monitors -j | jq -r ".[] | .name")

    notify-send -e Auto-Rotate "Monitors set to $*" -h string:key:auto-rotate
    hyprctl keyword input:touchdevice:transform "$TRANSFORM"
    hyprctl keyword input:tablet:transform "$TRANSFORM"
}

export -f rotate
monitor-sensor --accel | stdbuf -oL grep orientation | stdbuf -oL cut -d : -f 2 | stdbuf -oL rev | stdbuf -oL cut -d , -f 2- | stdbuf -oL rev | stdbuf -oL sed 's/[ )]//g' | xargs -I '{}' bash -c "rotate '{}'"
