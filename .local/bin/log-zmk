#!/usr/bin/env bash

log_search=""
passthrough=false

while getopts 'ps:' flag; do
    case "${flag}" in
    p) passthrough=true ;;
    s) log_search="$OPTARG" ;;
    *) continue ;;
    esac
done
shift $((OPTIND - 1))

RG_FLAGS="-i"

if [[ -n "$log_search" ]]; then
    RG_FLAGS+=" $log_search"
    if [[ "$passthrough" == true ]]; then
        RG_FLAGS+=" --passthrough"
    fi

    sudo tio /dev/ttyACM0 </dev/tty | rg $RG_FLAGS
else
    sudo tio /dev/ttyACM0 </dev/tty
fi
