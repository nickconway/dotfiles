#!/usr/bin/env bash
set -euo pipefail

if [[ -n "${LOG:-}" ]]; then
    exec &>"/tmp/$(basename "$0").log"
    set -x
fi

if [[ -n "${DEBUG_MODE:-}" ]]; then
    set -x
fi

[[ -n "${NVM_DIR:-}" ]] && [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

if [[ ! -e "$1" ]]; then
    pnpx sv create "$1"
fi

cd "$1"
FOLDER=${PWD##*/}
FOLDER=${FOLDER:-/}
session_name="$(echo "$FOLDER" | tr . _)"

if [[ ! -e .git ]]; then
    git init
    git add -A
    git commit -m "Initial commit"
fi

TMUXP_START_DIR="$PWD" TMUXP_SESSION_NAME=$session_name tmuxp load ~/.config/tmuxp/svelte-kit.yaml -y >/dev/null
