#!/usr/bin/env bash
set -euo pipefail

if [[ -n "${LOG:-}" ]]; then
    exec &>"/tmp/$(basename "$0").log"
    set -x
fi

if [[ -n "${DEBUG_MODE:-}" ]]; then
    set -x
fi

cd
while read -r f; do
    echo "~/${f%%.template}:"
    envsubst <"$HOME/$f" | tee "${f%%.template}"
    echo
done < <(fd --type f --hidden '\.template$' "$1")
