#!/usr/bin/env bash
set -euo pipefail

if [[ -n "${DEBUG_MODE:-}" ]]; then
	set -x
fi

while true; do
    if pactl -f json list source-outputs | jq -r '.[].properties["media.name"]' | grep -q RecordStream; then
        systemd-inhibit --what sleep:idle --why "Microphone in use" sleep 1
    else
        sleep 1
    fi
done
