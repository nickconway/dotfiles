#!/usr/bin/env bash
set -euo pipefail

sleep .5
URL="$(playerctl metadata | rg Url | nth-to-end 3 | sed "s/size=300/size=80/")"

if pgrep -f "qs -c caelestia"; then
    TEXT="$(playerctl metadata -f "{{title}} - {{artist}}")"
else
    TEXT="$(playerctl metadata -f "{{title}}\n{{artist}}")"
fi

curl -s "$URL" --output /tmp/feishin-cover.png
notify-send "Now Playing" "$TEXT" -i /tmp/feishin-cover.png -e -h string:key:audio
