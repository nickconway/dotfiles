#!/bin/bash
if [[ -z "$@" ]]; then
    LIST=$(rbw list --fields name,user,id | sed "s/\t/ /g")

    if command -v rofi &> /dev/null; then
        SELECTED=$(echo "$LIST" | awk 'NF{NF-=1};1' | rofi -dmenu)
    else
        SELECTED=$(echo "$LIST" | awk 'NF{NF-=1};1' | fzf-tmux -p)
    fi

    if [[ -n $SELECTED ]]; then
        ID=$(echo "$LIST" | rg "$SELECTED" | awk '{print $NF}')
        if command -v clip.exe > /dev/null; then
            echo -n $(rbw get $ID) | clip.exe
        elif command -v wl-copy > /dev/null; then
            echo -n $(rbw get $ID) | wl-copy && paste-keys
        fi
    fi
else
    if command -v clip.exe > /dev/null; then
        echo -n $(rbw get $@) | clip.exe
    elif command -v wl-copy > /dev/null; then
        echo -n $(rbw get $@) | wl-copy && paste-keys
    fi
fi
