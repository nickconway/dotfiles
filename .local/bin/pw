#!/usr/bin/env bash
set -euo pipefail

if [[ -z "$@" ]]; then
    LIST=$(rbw list --fields name,user,id | sed "s/\t/ /g")

    if [[ ! -t 0 ]]; then
        SELECTED=$(echo "$LIST" | awk 'NF{NF-=1};1' | rofi -dmenu -p ó±‰¼ -i -config ~/.config/rofi/styles/style_2.rasi -theme-str 'listview { columns: 1; } mode-switcher { enabled: false; }' )
    else
        SELECTED=$(echo "$LIST" | awk 'NF{NF-=1};1' | fzft)
    fi

    if [[ -n $SELECTED ]]; then
        ID=$(echo "$LIST" | rg "$SELECTED" | awk '{print $NF}')
        if command -v clip.exe > /dev/null; then
            echo -n $(rbw get $ID) | clip.exe
        elif [[ ! -t 0 ]] && command -v wl-copy > /dev/null; then
            rbw get $ID | wl-copy -n && paste-keys
        else
            rbw get $ID
        fi
    fi
else
    if command -v clip.exe > /dev/null; then
        echo -n $(rbw get "$@") | clip.exe
    elif [[ ! -t 0 ]] && command -v wl-copy > /dev/null; then
        rbw get "$@" | wl-copy -n && paste-keys
    else
        rbw get "$@"
    fi
fi
