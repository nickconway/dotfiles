#!/usr/bin/env bash
set -euo pipefail

if [[ -n "${LOG:-}" ]]; then
    exec &>"/tmp/$(basename "$0").log"
    set -x
fi

if [[ -n "${DEBUG_MODE:-}" ]]; then
    set -x
fi

pgrep -af "$*" | grep -v $PPID | grep -v "$0 $*" | while read -r LINE; do
    kill $(cut -d ' ' -f 1 <<<"$LINE")
    eval "$(cut -d ' ' -f 2- <<<"$LINE")" &
done
