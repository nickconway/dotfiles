#!/usr/bin/env bash

set -euo pipefail

export BORG_PASSPHRASE=$BORG_PASSPHRASE
export BORG_REPO="${1:-}"

[[ -e "$BORG_REPO" ]]

ARCHIVE="$(borg list | fzf-tmux -p --tac | awk '{print $1}')"
echo Restoring "$ARCHIVE"

if [[ $# -gt 1 ]]; then
    borg extract --debug --progress ::"$ARCHIVE" "${@:2}"
else
    borg extract --debug --progress ::"$ARCHIVE"
fi

if [[ -e ~/Docker/invoice-ninja/app ]]; then
    sudo chmod 755 ~/Docker/invoice-ninja/app
    sudo chown -R 1500:1500 ~/Docker/invoice-ninja/app
fi
