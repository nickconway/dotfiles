#!/bin/bash
set -euo pipefail

IMG=$(xdg-user-dir PICTURES)/Screenshots/$(date +%Y-%m-%d_%H-%M-%S).png
if [[ $# -eq 0 ]]; then
    REGION="$(slurp -c cba67f88 -b 00000099 -w 0 -B 00000099)"
elif [[ "$1" == "window" ]]; then
    REGION="$(hyprctl clients -j \
        | jq -r '.[] | select(.workspace.id | tostring | test("'"$(echo $(hyprctl monitors -j | jq ".[].activeWorkspace.id") | sed "s/ /|/g")"'")) | "\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"' \
        | slurp -c cba67f88 -b 00000099 -w 0 -B 00000099)"
elif [[ "$1" == "monitor" ]]; then
    if [[ "$(hyprctl monitors -j | jq -r '.[] | .name' | wc -l)" == "1" ]]; then
        OUTPUT="$(hyprctl monitors -j | jq -r '.[] | .name')"
    else
        REGION="$(slurp -o -c cba67f88 -b 00000099 -w 0 -B 00000099)"
    fi
else
    exit
fi

if [[ -n "${REGION:-}" ]]; then
    grim -g "$REGION" -l 0 $IMG
elif [[ -n "${OUTPUT:-}" ]]; then
    grim -o "$OUTPUT" -l 0 $IMG
fi

wl-copy < $IMG
(
    ACTION=$(notify-send -i "$IMG" "Screenshot Saved and Copied to Clipboard: $IMG" --action "open=Open")
    [[ "$ACTION" == "open" ]] && xdg-open "$IMG"
) &
