#!/usr/bin/env bash
set -euo pipefail

if [[ -n "${DEBUG_MODE:-}" ]]; then
    set -x
fi

if [[ $1 == "do" ]]; then
    if pidof hyprlock; then
        touch /tmp/.sunshine-locked
        pkill -USR1 hyprlock
    fi

    if pidof swaync; then
        swaync-client -dn
    fi
    qs -c caelestia ipc call gameMode enable
    sunshine-headless enable
elif [[ $1 == "undo" ]]; then
    sunshine-headless disable

    if pidof swaync; then
        swaync-client -df
    fi

    qs -c caelestia ipc call gameMode disable

    if [[ -e /tmp/.sunshine-locked ]]; then
        rm /tmp/.sunshine-locked
        hyprlock
    fi
fi
