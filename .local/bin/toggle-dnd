#!/usr/bin/env bash
set -euo pipefail

if [[ -n "${LOG:-}" ]]; then
    exec &>"/tmp/$(basename "$0").log"
    set -x
fi

if [[ -n "${DEBUG_MODE:-}" ]]; then
    set -x
fi

if pgrep -afx "qs -c caelestia.*"; then
    qs -c caelestia ipc call notifs toggleDnd
elif pgrep -afx "qs -c noctalia.*"; then
    qs -c noctalia ipc call notifications toggleDND
elif pgrep -afx "qs -c dms.*" &>/dev/null; then
    qs -c dms ipc call notifications toggleDoNotDisturb
fi

if pgrep -x "swaync"; then
    swaync-client -d
    if [[ $(swaync-client -D) == "false" ]]; then
        notify-send "Do Not Disturb" "Do not disturb is now off" -h string:synchronous:dnd -e
    fi
fi
