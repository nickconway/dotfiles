#!/bin/bash
journalctl -t upssched-cmd -f | while read -r line; do
    echo "$line"
    case "$line" in
        *ONLINE)
            notify-send "UPS Status" "UPS Switched to Main Power" -e
        ;;
        *ONBATT)
            (
                ACTION=$(timeout 11s notify-send "UPS Status" "UPS Switched to Battery Power" --action "keep-awake=Keep Awake" -e)
                case $ACTION in
                    '') [[ -e /tmp/ups-status-ONLINE ]] || shutdown -h now &>/dev/null;;
                esac
            ) &
        ;;
    esac
done
